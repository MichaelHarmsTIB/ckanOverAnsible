---
- name: Create postgres user
  become: yes
  become_user: postgres
  postgresql_user:
    name: "ckan_default"
    password: "ckan123"

- name: create ckan db
  become: yes
  become_user: postgres
  postgresql_db:
    name: ckan_default
    encoding: UTF-8

- name: Ensure CKAN database exists
  become_user: postgres
  become: yes
  postgresql_db:
    name: "ckan_default"
    encoding: UTF-8
    lc_collate: en_US.utf8
    lc_ctype: en_US.utf8
    template: template0

- name: Ensure CKAN database user exists
  become_user: postgres
  become: yes
  postgresql_user:
    db: "ckan_default"
    name: "ckan_default"
    password: "{{ ckan_database_password }}"
    priv: ALL